<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminBookingActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">com.example.pengu</a> &gt; <span class="el_source">AdminBookingActivity.java</span></div><h1>AdminBookingActivity.java</h1><pre class="source lang-java linenums">package com.example.pengu;

import androidx.appcompat.app.AppCompatActivity;
import java.util.ArrayList;
import android.os.Bundle;
import androidx.recyclerview.widget.GridLayoutManager;
import android.os.Bundle;
import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import java.util.List;
import android.widget.Toast;
import android.os.Bundle;
import androidx.appcompat.app.AppCompatActivity;
import com.android.volley.Request;
import com.android.volley.toolbox.JsonArrayRequest;
import com.android.volley.toolbox.Volley;
import org.json.JSONException;
import org.json.JSONObject;
import java.util.HashMap;
import java.util.Map;
import android.widget.Button;
import org.json.JSONArray;
import org.json.JSONObject;
import org.json.JSONException;
import android.util.Log;
import com.android.volley.Request;
import com.android.volley.toolbox.JsonObjectRequest;
import org.json.JSONException;
import org.json.JSONObject;
import java.nio.charset.StandardCharsets;
import java.util.Iterator;
import android.app.AlertDialog;
import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.EditText;
import com.android.volley.Request;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.JsonObjectRequest;
import com.android.volley.toolbox.StringRequest;
import android.content.SharedPreferences;
import com.android.volley.AuthFailureError;


import com.android.volley.toolbox.Volley;
import com.example.pengu.VolleySingleton; // Replace with your VolleySingleton class path
import com.example.pengu.BookingInfo; // Replace with your BookingInfo class path

import org.json.JSONException;
import org.json.JSONObject;

import java.nio.charset.StandardCharsets;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.List;


import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import android.os.Bundle;
import com.android.volley.Request;
import com.android.volley.toolbox.JsonArrayRequest;
import org.json.JSONException;
import org.json.JSONObject;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import android.util.Log;

<span class="fc" id="L77">public class AdminBookingActivity extends AppCompatActivity {</span>
<span class="fc" id="L78">    private Map&lt;Integer, String&gt; subjectIdToNameMap = new HashMap&lt;&gt;();</span>
    private RecyclerView subjectsRecyclerView;
    private BookingAdapter adapter;
<span class="fc" id="L81">    private List&lt;BookingInfo&gt; bookingList = new ArrayList&lt;&gt;(); // Initialized as an empty list</span>
    private Button addSubjectButton;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="fc" id="L87">        super.onCreate(savedInstanceState);</span>
<span class="fc" id="L88">        setContentView(R.layout.activity_admin_booking);</span>

<span class="fc" id="L90">        subjectsRecyclerView = findViewById(R.id.subjectsRecyclerView);</span>
        // LinearLayoutManager layoutManager = new LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false);
<span class="fc" id="L92">        GridLayoutManager layoutManager = new GridLayoutManager(this, 2); // Use a span count of 2 for two columns</span>
<span class="fc" id="L93">        subjectsRecyclerView.setLayoutManager(layoutManager);</span>
<span class="fc" id="L94">        addSubjectButton = findViewById(R.id.addSubjectButton);</span>

<span class="fc" id="L96">        addSubjectButton.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View v) {
<span class="fc" id="L99">                showCreateBookingDialog();</span>

<span class="fc" id="L101">            }</span>
        });

<span class="fc" id="L104">        adapter = new BookingAdapter(this, bookingList, subjectIdToNameMap, new BookingAdapter.OnItemClickListener() {</span>
            @Override
            public void onDeleteClick(int position) {
                // Handle the delete action
<span class="nc" id="L108">                int bookingId = bookingList.get(position).getId();</span>
<span class="nc" id="L109">                deleteBooking(bookingId);</span>
<span class="nc" id="L110">            }</span>

            @Override
            public void onEditClick(int position) {
<span class="nc" id="L114">                showEditBookingDialog(bookingList.get(position), position); // Implement this method</span>
<span class="nc" id="L115">            }</span>

            @Override
            public void onClick() {
                // Implement this method if needed
<span class="nc" id="L120">            }</span>
        });

<span class="fc" id="L123">        subjectsRecyclerView.setAdapter(adapter);</span>
<span class="fc" id="L124">        adapter.notifyDataSetChanged();</span>
<span class="fc" id="L125">        fetchSubjectNames();</span>

<span class="fc" id="L127">        fetchBookingInfo(); // Fetch the booking data directly</span>
<span class="fc" id="L128">    }</span>

    private void fetchBookingInfo() {
<span class="fc" id="L131">        String url = &quot;http://coms-309-037.class.las.iastate.edu:8080/printBookingInfo&quot;;</span>
<span class="fc" id="L132">        JsonArrayRequest jsonArrayRequest = new JsonArrayRequest(Request.Method.GET, url, null,</span>
                response -&gt; {
<span class="fc" id="L134">                    bookingList.clear(); // Clear the list before adding new data</span>
<span class="fc" id="L135">                    parseBookingJson(response);</span>
<span class="fc" id="L136">                    adapter.notifyDataSetChanged(); // Notify the adapter to refresh the view</span>
<span class="fc" id="L137">                },</span>
                error -&gt; {
                    // Handle error
<span class="nc" id="L140">                    error.printStackTrace();</span>
<span class="nc" id="L141">                }</span>
        );

<span class="fc" id="L144">        VolleySingleton.getInstance(this).addToRequestQueue(jsonArrayRequest);</span>
<span class="fc" id="L145">    }</span>

    private void parseBookingJson(JSONArray response) {
        try {

<span class="fc bfc" id="L150" title="All 2 branches covered.">            for (int i = 0; i &lt; response.length(); i++) {</span>
<span class="fc" id="L151">                JSONObject bookingJson = response.getJSONObject(i);</span>
<span class="fc" id="L152">                int id = bookingJson.getInt(&quot;id&quot;);</span>

                // Check if the &quot;subject&quot; field is null
                int subjectID;
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">                if (!bookingJson.isNull(&quot;subject&quot;)) {</span>
<span class="fc" id="L157">                    subjectID = bookingJson.getJSONObject(&quot;subject&quot;).getInt(&quot;subjectID&quot;);</span>
                } else {
<span class="nc" id="L159">                    subjectID = -1; // or any other suitable value for null subject</span>
                }
<span class="fc" id="L161">                Log.d(&quot;parseBookingJson&quot;, &quot;This is parseBookinhJson&quot;);</span>

<span class="fc" id="L163">                int teacherID = bookingJson.getJSONObject(&quot;teacher&quot;).getInt(&quot;id&quot;);</span>
<span class="fc" id="L164">                int studentID = bookingJson.getJSONObject(&quot;student&quot;).getInt(&quot;id&quot;);</span>
<span class="fc" id="L165">                String teacherName = bookingJson.getJSONObject(&quot;teacher&quot;).getString(&quot;name&quot;);</span>
<span class="fc" id="L166">                String studentName = bookingJson.getJSONObject(&quot;student&quot;).getString(&quot;name&quot;);</span>
<span class="fc" id="L167">                String date = bookingJson.getString(&quot;date&quot;);</span>
<span class="fc" id="L168">                String startTime = bookingJson.getString(&quot;startTime&quot;);</span>
<span class="fc" id="L169">                String endTime = bookingJson.getString(&quot;endTime&quot;);</span>

<span class="fc" id="L171">                bookingList.add(new BookingInfo(id, subjectID, teacherID, studentID, teacherName, studentName, date, startTime, endTime));</span>
            }
<span class="fc" id="L173">            adapter.notifyDataSetChanged();</span>
<span class="fc" id="L174">            Log.d(&quot;AdminBookingActivity&quot;, &quot;Number of bookings: &quot; + bookingList.size());</span>
<span class="nc" id="L175">        } catch (JSONException e) {</span>
<span class="nc" id="L176">            e.printStackTrace();</span>
<span class="fc" id="L177">        }</span>
<span class="fc" id="L178">    }</span>

    public void fetchSubjectNames() {
<span class="fc" id="L181">        String url = &quot;http://coms-309-037.class.las.iastate.edu:8080/printSubject&quot;;</span>

<span class="fc" id="L183">        JsonArrayRequest jsonArrayRequest = new JsonArrayRequest(Request.Method.GET, url, null,</span>
                response -&gt; {
                    try {
<span class="fc bfc" id="L186" title="All 2 branches covered.">                        for (int i = 0; i &lt; response.length(); i++) {</span>
<span class="fc" id="L187">                            JSONObject subjectObject = response.getJSONObject(i);</span>
<span class="fc" id="L188">                            int id = subjectObject.getInt(&quot;subjectID&quot;);</span>
<span class="fc" id="L189">                            String name = subjectObject.getString(&quot;subjectName&quot;);</span>
<span class="fc" id="L190">                            subjectIdToNameMap.put(id, name);</span>
                        }
                        // Log the contents of subjectIdToNameMap to check it
<span class="fc bfc" id="L193" title="All 2 branches covered.">                        for (Map.Entry&lt;Integer, String&gt; entry : subjectIdToNameMap.entrySet()) {</span>
<span class="fc" id="L194">                            Log.d(&quot;SubjectMap&quot;, &quot;ID: &quot; + entry.getKey() + &quot; Name: &quot; + entry.getValue());</span>
<span class="fc" id="L195">                        }</span>

                        // Continue with the rest of your logic, such as fetching bookings
                        //fetchBookingInfo();
<span class="nc" id="L199">                    } catch (JSONException e) {</span>
<span class="nc" id="L200">                        e.printStackTrace();</span>
                        // Handle error
<span class="fc" id="L202">                    }</span>
<span class="fc" id="L203">                },</span>
                error -&gt; {
                    // Handle error
<span class="nc" id="L206">                    error.printStackTrace();</span>
<span class="nc" id="L207">                });</span>

<span class="fc" id="L209">        VolleySingleton.getInstance(this).addToRequestQueue(jsonArrayRequest);</span>
<span class="fc" id="L210">    }</span>

    public void deleteBooking(int bookingId) {
        // The bookingId is appended to the URL path
<span class="nc" id="L214">        String url = &quot;http://coms-309-037.class.las.iastate.edu:8080/deleteBooking/&quot; + bookingId;</span>

        // Create a StringRequest for the DELETE request without a request body
<span class="nc" id="L217">        StringRequest deleteRequest = new StringRequest(Request.Method.DELETE, url,</span>
                response -&gt; {
                    // Handle the successful deletion
<span class="nc" id="L220">                    Log.d(&quot;DeleteBooking&quot;, &quot;Booking deleted successfully.&quot;);</span>
                    // Update your local data and UI accordingly
<span class="nc" id="L222">                    removeFromBookingListById(bookingId);</span>
<span class="nc" id="L223">                },</span>
                error -&gt; {
                    // Handle any errors
<span class="nc" id="L226">                    Log.e(&quot;DeleteBooking&quot;, &quot;Error deleting booking: &quot; + error.toString());</span>
<span class="nc" id="L227">                }) {</span>
            @Override
            public Map&lt;String, String&gt; getHeaders() {
<span class="nc" id="L230">                Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L231">                headers.put(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;);</span>
<span class="nc" id="L232">                headers.put(&quot;Authorization&quot;, &quot;Bearer YOUR_AUTH_TOKEN_HERE&quot;); // Replace with actual token if needed</span>
<span class="nc" id="L233">                return headers;</span>
            }
        };

        // Add the request to the Volley request queue
<span class="nc" id="L238">        VolleySingleton.getInstance(this.getApplicationContext()).addToRequestQueue(deleteRequest);</span>
<span class="nc" id="L239">    }</span>

    private void removeFromBookingListById(int bookingId) {
        // Loop through the bookingList and remove the booking with the given id
<span class="nc" id="L243">        Iterator&lt;BookingInfo&gt; iterator = bookingList.iterator();</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        while (iterator.hasNext()) {</span>
<span class="nc" id="L245">            BookingInfo booking = iterator.next();</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">            if (booking.getId() == bookingId) {</span>
                // Remove the current item from the iterator and the list
<span class="nc" id="L248">                iterator.remove();</span>
                // Notify the adapter of the item removed
<span class="nc" id="L250">                adapter.notifyDataSetChanged();</span>
<span class="nc" id="L251">                return;</span>
            }
<span class="nc" id="L253">        }</span>
<span class="nc" id="L254">    }</span>

    public void showEditBookingDialog(BookingInfo booking, int position) {
<span class="nc" id="L257">        AlertDialog.Builder builder = new AlertDialog.Builder(this);</span>
<span class="nc" id="L258">        LayoutInflater inflater = getLayoutInflater();</span>
<span class="nc" id="L259">        View dialogView = inflater.inflate(R.layout.dialog_edit_booking, null);</span>
<span class="nc" id="L260">        builder.setView(dialogView);</span>

        // Find the EditText views in your dialog layout
<span class="nc" id="L263">        EditText editDate = dialogView.findViewById(R.id.editDate);</span>
<span class="nc" id="L264">        EditText editStartTime = dialogView.findViewById(R.id.editStartTime);</span>
<span class="nc" id="L265">        EditText editEndTime = dialogView.findViewById(R.id.editEndTime);</span>
        // Initialize EditText with current booking info
<span class="nc" id="L267">        editDate.setText(booking.getDate());</span>
<span class="nc" id="L268">        editStartTime.setText(booking.getStartTime());</span>
<span class="nc" id="L269">        editEndTime.setText(booking.getEndTime());</span>

        // ... setup other EditText views for different attributes as needed

        // When &quot;Save&quot; is clicked...
<span class="nc" id="L274">        builder.setPositiveButton(&quot;Save&quot;, (dialog, which) -&gt; {</span>
            // Collect updated values from EditText views
<span class="nc" id="L276">            String newDate = editDate.getText().toString();</span>
<span class="nc" id="L277">            String newStartTime = editStartTime.getText().toString();</span>
<span class="nc" id="L278">            String newEndTime = editEndTime.getText().toString();</span>

            // ... collect other updated values

            // Update the booking object with new values
<span class="nc" id="L283">            booking.setDate(newDate);</span>
<span class="nc" id="L284">            booking.setStartTime(newStartTime);</span>
<span class="nc" id="L285">            booking.setEndTime(newEndTime);</span>

            // ... update other attributes of the booking object

            // Now, pass the updated booking object to updateBookingOnServer
<span class="nc" id="L290">            updateBookingOnServer(booking, position);</span>
<span class="nc" id="L291">        });</span>

<span class="nc" id="L293">        builder.setNegativeButton(&quot;Cancel&quot;, (dialog, which) -&gt; dialog.dismiss());</span>
<span class="nc" id="L294">        builder.create().show();</span>
<span class="nc" id="L295">    }</span>

    private void updateBookingOnServer(BookingInfo updatedBooking, int position) {
<span class="nc" id="L298">        Log.d(&quot;updateBookingServer&quot;, &quot;this is updateBookingServer&quot;);</span>
<span class="nc" id="L299">        String url = &quot;http://coms-309-037.class.las.iastate.edu:8080/updateBookingInfo&quot;;</span>
<span class="nc" id="L300">        JSONObject updateParams = new JSONObject();</span>
        try {
<span class="nc" id="L302">            updateParams.put(&quot;id&quot;, updatedBooking.getId());</span>
<span class="nc" id="L303">            updateParams.put(&quot;subject&quot;, new JSONObject().put(&quot;subjectID&quot;, updatedBooking.getSubjectID()));</span>
<span class="nc" id="L304">            updateParams.put(&quot;teacher&quot;, new JSONObject().put(&quot;id&quot;, updatedBooking.getTeacherID()));</span>
<span class="nc" id="L305">            updateParams.put(&quot;student&quot;, new JSONObject().put(&quot;id&quot;, updatedBooking.getStudentID()));</span>
<span class="nc" id="L306">            updateParams.put(&quot;date&quot;, updatedBooking.getDate());</span>
<span class="nc" id="L307">            updateParams.put(&quot;startTime&quot;, updatedBooking.getStartTime());</span>
<span class="nc" id="L308">            updateParams.put(&quot;endTime&quot;, updatedBooking.getEndTime());</span>

            // Add other fields as necessary
<span class="nc" id="L311">        } catch (JSONException e) {</span>
<span class="nc" id="L312">            e.printStackTrace();</span>
<span class="nc" id="L313">        }</span>

<span class="nc" id="L315">        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(Request.Method.PUT, url, updateParams,</span>
                response -&gt; {
                    // Handle successful update
<span class="nc" id="L318">                    bookingList.set(position, updatedBooking); // Update the list</span>
<span class="nc" id="L319">                    adapter.notifyItemChanged(position); // Notify the adapter of the change</span>
<span class="nc" id="L320">                },</span>
                error -&gt; {
                    // Handle error
<span class="nc" id="L323">                    Log.e(&quot;UpdateBooking&quot;, &quot;Error: &quot; + error.toString());</span>
<span class="nc" id="L324">                }) {</span>
            @Override
            public Map&lt;String, String&gt; getHeaders() {
<span class="nc" id="L327">                Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L328">                headers.put(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;);</span>
                // Add other headers if necessary, such as Authorization
<span class="nc" id="L330">                return headers;</span>
            }
        };

<span class="nc" id="L334">        VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(jsonObjectRequest);</span>
<span class="nc" id="L335">    }</span>

    public void showCreateBookingDialog() {
<span class="fc" id="L338">        Log.d(&quot;AdminBookingActivity&quot;, &quot;showCreateBookingDialog called.&quot;);</span>
<span class="fc" id="L339">        AlertDialog.Builder builder = new AlertDialog.Builder(this);</span>
<span class="fc" id="L340">        LayoutInflater inflater = getLayoutInflater();</span>
<span class="fc" id="L341">        View dialogView = inflater.inflate(R.layout.dialog_create_booking, null);</span>
<span class="fc" id="L342">        builder.setView(dialogView);</span>

       // EditText editSubjectID = dialogView.findViewById(R.id.editSubjectID);
<span class="fc" id="L345">        EditText editSubjectName = dialogView.findViewById(R.id.editSubjectName);</span>
<span class="fc" id="L346">        EditText editTeacherID = dialogView.findViewById(R.id.editTeacherID);</span>
<span class="fc" id="L347">        EditText editStudentID = dialogView.findViewById(R.id.editStudentID);</span>
<span class="fc" id="L348">        EditText editDate = dialogView.findViewById(R.id.editDate);</span>
<span class="fc" id="L349">        EditText editStartTime = dialogView.findViewById(R.id.editStartTime);</span>
<span class="fc" id="L350">        EditText editEndTime = dialogView.findViewById(R.id.editEndTime);</span>


        // ... other EditTexts for the booking information


<span class="fc" id="L356">        builder.setPositiveButton(&quot;Create&quot;, (dialog, which) -&gt; {</span>


            try {
<span class="fc" id="L360">                Log.d(&quot;showCreateBookingDialog&quot;, &quot;Start creating booking&quot;);</span>
<span class="fc" id="L361">                String subjectName = editSubjectName.getText().toString();</span>
<span class="fc" id="L362">                Integer subjectId = null;</span>
                // Look for the subject ID based on the name entered by the user
<span class="pc bpc" id="L364" title="1 of 2 branches missed.">                for (Map.Entry&lt;Integer, String&gt; entry : subjectIdToNameMap.entrySet()) {</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">                    if (entry.getValue().equalsIgnoreCase(subjectName)) {</span>
<span class="fc" id="L366">                        subjectId = entry.getKey();</span>
<span class="fc" id="L367">                        break;</span>
                    }
<span class="nc" id="L369">                }</span>

<span class="pc bpc" id="L371" title="1 of 2 branches missed.">                if (subjectId == null) {</span>
<span class="nc" id="L372">                    Log.e(&quot;showCreateBookingDialog&quot;, &quot;Subject ID not found for name: &quot; + subjectName);</span>
<span class="nc" id="L373">                    Toast.makeText(this, &quot;Subject name is invalid&quot;, Toast.LENGTH_LONG).show();</span>
<span class="nc" id="L374">                    return; // Exit the method if subject ID wasn't found</span>
                }
<span class="fc" id="L376">                Log.d(&quot;showCreateBookingDialog&quot;, &quot;Subject ID for &quot; + subjectName + &quot; is &quot; + subjectId);</span>
               // int subjectId = Integer.parseInt(editSubjectID.getText().toString());
<span class="fc" id="L378">                int teacherId = Integer.parseInt(editTeacherID.getText().toString());</span>
<span class="fc" id="L379">                int studentId = Integer.parseInt(editStudentID.getText().toString());</span>


<span class="fc" id="L382">                JSONObject bookingDetails = new JSONObject();</span>

                //bookingDetails.put(&quot;subject&quot;, new JSONObject().put(&quot;subjectID&quot;, subjectId));
<span class="fc" id="L385">                bookingDetails.put(&quot;teacher&quot;, new JSONObject().put(&quot;id&quot;, teacherId));</span>
<span class="fc" id="L386">                bookingDetails.put(&quot;student&quot;, new JSONObject().put(&quot;id&quot;, studentId));</span>
<span class="fc" id="L387">                bookingDetails.put(&quot;date&quot;, editDate.getText().toString());</span>

<span class="fc" id="L389">                bookingDetails.put(&quot;startTime&quot;, editStartTime.getText().toString());</span>
<span class="fc" id="L390">                bookingDetails.put(&quot;endTime&quot;, editEndTime.getText().toString());</span>
<span class="fc" id="L391">                bookingDetails.put(&quot;subject&quot;, new JSONObject().put(&quot;subjectID&quot;, subjectId));</span>
                //bookingDetails.put(&quot;endTime&quot;,&quot;2024/03/28&quot;);

<span class="fc" id="L394">                Log.d(&quot;showCreateBookingDialog&quot;, &quot;this is the end create booking should be called&quot;);</span>


<span class="fc" id="L397">                createBooking(bookingDetails);</span>

<span class="nc" id="L399">            } catch (JSONException e) {</span>
<span class="nc" id="L400">                Log.e(&quot;showCreateBookingDialog&quot;, &quot;JSONException: &quot; + e.getMessage());</span>
<span class="nc" id="L401">            } catch (NumberFormatException e) {</span>
<span class="nc" id="L402">                Log.e(&quot;showCreateBookingDialog&quot;, &quot;NumberFormatException: &quot; + e.getMessage());</span>
<span class="pc" id="L403">            }</span>
<span class="fc" id="L404">        });</span>

<span class="pc" id="L406">        builder.setNegativeButton(&quot;Cancel&quot;, (dialog, which) -&gt; dialog.dismiss());</span>
<span class="fc" id="L407">        builder.create().show();</span>
<span class="fc" id="L408">    }</span>

public void createBooking(JSONObject bookingDetails) {
<span class="fc" id="L411">    Log.d(&quot;CreateBooking&quot;, &quot;Attempting to create a booking...&quot;);</span>

<span class="fc" id="L413">    SharedPreferences sharedPreferences = getSharedPreferences(&quot;MyAppPreferences&quot;, MODE_PRIVATE);</span>
<span class="fc" id="L414">    String token = sharedPreferences.getString(&quot;AuthToken&quot;, &quot;&quot;);</span>
<span class="pc bpc" id="L415" title="1 of 2 branches missed.">    if (token.isEmpty()) {</span>
<span class="nc" id="L416">        Log.e(&quot;CreateBooking&quot;, &quot;Auth token is missing.&quot;);</span>
<span class="nc" id="L417">        return;</span>
    }

<span class="fc" id="L420">    String url = &quot;http://coms-309-037.class.las.iastate.edu:8080/createBooking/&quot; + token;</span>

<span class="fc" id="L422">    JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(</span>
            Request.Method.POST,
            url,
            bookingDetails,
            response -&gt; {
                try {
<span class="fc" id="L428">                    String message = response.getString(&quot;message&quot;);</span>
<span class="pc bpc" id="L429" title="1 of 2 branches missed.">                    if (&quot;success&quot;.equalsIgnoreCase(message)) {</span>
<span class="fc" id="L430">                        Log.d(&quot;CreateBooking&quot;, &quot;Booking created successfully.&quot;);</span>
                        // Refresh the page here
<span class="fc" id="L432">                        fetchBookingInfo(); // Re-fetch the booking info to update the list</span>
                    } else {
<span class="nc" id="L434">                        Log.e(&quot;CreateBooking&quot;, &quot;Booking creation failed: &quot; + message);</span>
                    }
<span class="nc" id="L436">                } catch (JSONException e) {</span>
<span class="nc" id="L437">                    Log.e(&quot;CreateBooking&quot;, &quot;JSON parsing error: &quot; + e.getMessage(), e);</span>
<span class="fc" id="L438">                }</span>
<span class="fc" id="L439">            },</span>
            error -&gt; {
<span class="nc bnc" id="L441" title="All 2 branches missed.">                if (error.networkResponse != null) {</span>
<span class="nc" id="L442">                    String statusCode = String.valueOf(error.networkResponse.statusCode);</span>
<span class="nc" id="L443">                    String responseData = new String(error.networkResponse.data, StandardCharsets.UTF_8);</span>
<span class="nc" id="L444">                    Log.e(&quot;CreateBooking&quot;, &quot;Error: StatusCode: &quot; + statusCode + &quot;, Data: &quot; + responseData);</span>
<span class="nc" id="L445">                } else {</span>
<span class="nc" id="L446">                    Log.e(&quot;CreateBooking&quot;, &quot;Error creating booking: &quot; + error.getMessage(), error);</span>
                }
<span class="pc" id="L448">            }) {</span>
        @Override
        public Map&lt;String, String&gt; getHeaders() {
<span class="fc" id="L451">            Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span>
<span class="fc" id="L452">            headers.put(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;);</span>
<span class="fc" id="L453">            headers.put(&quot;Authorization&quot;, &quot;Bearer &quot; + token);</span>
<span class="fc" id="L454">            return headers;</span>
        }
    };

<span class="fc" id="L458">    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(jsonObjectRequest);</span>
<span class="fc" id="L459">}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.2.2</div></body></html>